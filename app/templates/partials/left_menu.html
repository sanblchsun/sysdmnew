<!-- app/templates/partials/left_menu.html -->
<h2>Company Tree</h2>

<button id="toggle-all-btn" onclick="toggleAll()">Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ²ÑÑ‘</button>
<br />
<br />

{% macro render_node(node) %}
<li>
  {% if node.children %}
  <div class="node">
    <span class="arrow" onclick="toggleNode('{{ node.name_id }}', this)"
      >â–¶</span
    >
    <a
      class="label"
      hx-get="/ui/top-panel?target_type={{ node.type | trim }}&target_id={{ node.id | trim }}"
      hx-target="#top-right"
      hx-swap="innerHTML"
      hx-push-url="/agents?target_type={{ node.type | trim }}&target_id={{ node.id | trim }}"
      hx-indicator="#loading-indicator"
    >
      {% if node.type == "company" %} ğŸ›{{ node.name }} {% else %} ğŸ“{{
      node.name }} {% endif %}
    </a>
  </div>

  <ul class="collapsible" data-id="{{ node.name_id }}">
    {% for child in node.children %} {{ render_node(child) }} {% endfor %}
  </ul>
  {% else %}
  <div class="node">
    <span style="width: 1em"></span>
    <span class="label">
      {% if node.type == "agent" %} ğŸ‘¤ {{ node.name }} {% else %} ğŸ“{{ node.name
      }} {% endif %}
    </span>
  </div>
  {% endif %}
</li>
{% endmacro %}

<ul id="tree-root">
  {% for company in companies %} {{ render_node(company) }} {% endfor %}
</ul>
